{% extends "task_manager/base.html" %}
{% load bootstrap5 %}

{% block title %}Задачи{% endblock %}

{% block content %}
<style>
    .task-name-link:hover {
        color: #0d6efd;
        text-decoration: underline;
        cursor: pointer;
    }

    .tasks-table {
        table-layout: fixed;
        width: 100%;
    }
    
    .tasks-table th, .tasks-table td {
        word-wrap: break-word;
        overflow-wrap: break-word;
        word-break: break-word;
    }
    
    .tasks-table th:nth-child(2),
    .tasks-table td:nth-child(2) {
        max-width: 200px;
        width: 200px;
    }
    
    .tasks-table th:nth-child(3),
    .tasks-table td:nth-child(3) {
        max-width: 150px;
        width: 150px;
    }
    
    .tasks-table th:nth-child(4),
    .tasks-table td:nth-child(4) {
        max-width: 150px;
        width: 150px;
    }
    
    .filter-section {
        border: 1px solid #e4e4e4;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-select {
        border: 2px solid #ced4da;
        padding: 8px 12px;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-position: right 0.5em top 50%;
        background-size: 16px 16px;
        background-repeat: no-repeat;
    }

    .form-select:focus {
        border-color: #28a745;
        box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25);
    }

    .form-check-input:checked {
        background-color: #28a745;
        border-color: #28a745;
    }
    
    .btn-primary {
        width: 100px;
    }
</style>

<div class="container mt-5">
    <div class="mb-4">
        <h1>Задачи</h1>
        <a href="{% url 'task_create' %}" class="btn btn-primary mt-2">Создать задачу</a>
    </div>
    
    {% if messages %}
    <div class="messages mb-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="filter-section">
        <form method="get" class="row g-3">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="{{ filter.form.status.id_for_label }}">Статус</label>
                    {% bootstrap_field filter.form.status show_label=False %}
                </div>
                
                <div class="form-group">
                    <label for="{{ filter.form.executor.id_for_label }}">Исполнитель</label>
                    {% bootstrap_field filter.form.executor show_label=False %}
                </div>
                
                <div class="form-group">
                    <label for="{{ filter.form.labels.id_for_label }}">Метка</label>
                    {% bootstrap_field filter.form.labels show_label=False %}
                </div>
                
                <div class="form-check mb-3">
                    <input type="checkbox" 
                        name="{{ filter.form.self_author.name }}" 
                        id="{{ filter.form.self_author.id_for_label }}" 
                        class="form-check-input" 
                        {% if filter.form.self_author.value %}checked{% endif %}>
                    <label class="form-check-label" for="{{ filter.form.self_author.id_for_label }}">
                        Только свои задачи
                    </label>
                </div>
                
                <button type="submit" class="btn btn-primary mt-3">Показать</button>
            </div>
        </form>
    </div>

    <table class="table tasks-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Статус</th>
                <th>Автор</th>
                <th>Исполнитель</th>
                <th>Дата создания</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for task in filter.qs %}
            <tr>
                <td>{{ task.id }}</td>
                <td><a href="{% url 'task_detail' task.id %}" class="task-name-link">{{ task.name }}</a></td>
                <td>{{ task.status.name }}</td>
                <td>{{ task.author.username }}</td>
                <td>{{ task.executor.username|default:"" }}</td>
                <td>{{ task.created_at|date:"d.m.Y H:i" }}</td>
                <td>
                    <a href="{% url 'task_update' task.id %}" class="btn btn-sm btn-primary">Изменить</a>
                    <a href="{% url 'task_delete' task.id %}" class="btn btn-sm btn-danger">Удалить</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">Задач нет</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}